<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Demo Ставки</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }

        input {
            margin: 5px;
        }

        button {
            margin: 5px;
        }

        #history {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <h2>Demo Ставки</h2>

    <div id="auth">
        <h3>Регистрация / Вход</h3>
        <input type="email" id="email" placeholder="Email"><br>
        <input type="password" id="password" placeholder="Пароль"><br>
        <button onclick="signup()">Регистрация</button>
        <button onclick="login()">Вход</button>
    </div>

    <div id="game" style="display:none;">
        <h3>Баланс: <span id="balance">0</span>₽</h3>
        <input type="number" id="betAmount" placeholder="Сумма ставки">
        <button onclick="placeBet()">Сделать ставку ×2</button>

        <div id="history">
            <h4>История ставок</h4>
            <ul id="historyList"></ul>
        </div>

        <button onclick="logout()">Выйти</button>
    </div>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyD_BbeGYrJ1EVg9cPjjj-XmvcwO9cIIMec",
            authDomain: "trade-14bf9.firebaseapp.com",
            databaseURL: "https://trade-14bf9-default-rtdb.firebaseio.com",
            projectId: "trade-14bf9",
            storageBucket: "trade-14bf9.firebasestorage.app",
            messagingSenderId: "555237498779",
            appId: "1:555237498779:web:08aabda74ad26d6d860b3e",
            measurementId: "G-Q5LEHVWVZT"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let userId;

        // Регистрация
        function signup() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    userId = userCredential.user.uid;
                    db.collection('users').doc(userId).set({ balance: 1000, history: [] });
                    initGame();
                })
                .catch(console.error);
        }

        // Вход
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    userId = userCredential.user.uid;
                    initGame();
                })
                .catch(console.error);
        }

        // Инициализация игры
        function initGame() {
            document.getElementById('auth').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            loadBalance();
            loadHistory();
        }

        // Загрузка баланса
        function loadBalance() {
            db.collection('users').doc(userId).get().then(doc => {
                if (doc.exists) {
                    document.getElementById('balance').innerText = doc.data().balance;
                }
            });
        }

        // Загрузка истории
        function loadHistory() {
            db.collection('users').doc(userId).get().then(doc => {
                if (doc.exists) {
                    const history = doc.data().history || [];
                    const list = document.getElementById('historyList');
                    list.innerHTML = '';
                    history.forEach(h => {
                        const li = document.createElement('li');
                        li.innerText = `${h.date}: Ставка ${h.bet}₽ - ${h.result}`;
                        list.appendChild(li);
                    });
                }
            });
        }

        // Сделать ставку
        function placeBet() {
            const bet = parseInt(document.getElementById('betAmount').value);
            if (!bet) return alert('Введите сумму ставки');
            db.collection('users').doc(userId).get().then(doc => {
                const data = doc.data();
                if (bet > data.balance) return alert('Недостаточно средств');

                // Рандомный результат
                const win = Math.random() < 0.5;
                const newBalance = win ? data.balance + bet : data.balance - bet;
                const newHistory = data.history || [];
                newHistory.unshift({
                    date: new Date().toLocaleString(),
                    bet,
                    result: win ? `Выигрыш +${bet}₽` : `Проигрыш -${bet}₽`
                });

                db.collection('users').doc(userId).update({
                    balance: newBalance,
                    history: newHistory
                }).then(() => {
                    loadBalance();
                    loadHistory();
                });
            });
        }

        // Выход
        function logout() {
            auth.signOut().then(() => {
                document.getElementById('auth').style.display = 'block';
                document.getElementById('game').style.display = 'none';
            });
        }


        auth.onAuthStateChanged(user => {
            if (user) {
                userId = user.uid;
                initGame();
            } else {
                document.getElementById('auth').style.display = 'block';
                document.getElementById('game').style.display = 'none';
            }
        });

    </script>

</body>

</html>